name: lshboshethNest CI

on:
  push:
    branches: [ master ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-22.04  # 使用最新的LTS版本
    
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v4
      
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '22' # 或者指定具体的版本号，如 '22.x'

    - name: Install dependencies
      run: npm ci # 严格依赖锁定（优于 npm install）

    - name: Deploy 🚀
      uses: cross-the-world/ssh-scp-ssh-pipelines@latest
      env:
        WELCOME: "ssh scp ssh pipelines"
        LASTSSH: "Doing something after copying"
      with:
        host: ${{ secrets.DR_HOST }}
        user: ${{ secrets.DR_USER }}
        pass: ${{ secrets.DR_PASS }}
        connect_timeout: 10s
        first_ssh: |
          rm -rf /home/lshboshethNest
        scp: |
          ./* => /home/lshboshethNest
        last_ssh: |
          cd /home/lshboshethNest
